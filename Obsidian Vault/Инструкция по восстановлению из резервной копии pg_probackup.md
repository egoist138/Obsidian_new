

## 1. Просмотр доступных резервных копий

```bash
/opt/pgpro/bin/pg_probackup3 show -B ./probackup/
```
Запомните дату последней копии (например: `2025-12-04-00-00-02-295`)

## 2. Восстановление копии

```bash
/opt/pgpro/bin/pg_probackup3 restore -B ./probackup -D ./restore_db/ -i 2025-12-04-00-00-02-295 --instance pg16
```

Где:
- `-B ./probackup` — путь к каталогу с резервными копиями
- `-D ./restore_db/` — куда восстановить базу данных
- `-i 2025-12-04-00-00-02-295` — дата копии для восстановления

## 3. Настройка порта сервера

По умолчанию PostgreSQL использует порт 5432. Если на этом порту уже работает другая база, измените его:
```bash
nano ./restore_db/postgresql.conf
```

Найдите параметр `port = 5432` и измените на другой (например: `port = 6432`)

## 4. Отключение архивации WAL

Чтобы новая база не архивировала логи в старую папку:
```bash
nano ./restore_db/postgresql.conf
```

Найдите `archive_command` и закомментируйте его или установите:
```sql
archive_mode = off
```

## 5. Удаление параметров репликации

Проверьте два файла:
- `./restore_db/postgresql.conf`
- `./restore_db/postgresql.auto.conf`

Если в `postgresql.auto.conf` есть такие строки, удалите их:
```yml
primary_conninfo = 'user=backup password=''dasdsad'' ...'
primary_slot_name = 'replica_gas_service_db'
```

## 6. Преобразование реплики в мастер

Запустите PostgreSQL с новым портом, затем:
```bash
psql -p 6432
```

В psql выполните:
```sql
SELECT pg_promote();
```

## 7. Проверка статуса

```sql
SELECT pg_is_in_recovery();
```

Результат должен быть:

- `f` (false) — база стала мастером     
- `t` (true) — база все еще реплика 
## Важные моменты:

1. **Не пропускайте смену порта** — иначе не запустите новую базу
2. **Убедитесь, что архивация отключена** — чтобы не повредить архив основной базы
3. **Удалите все параметры репликации** — иначе база может пытаться подключиться к старому мастеру
4. **Не забудьте выполнить `pg_promote()`** — если восстанавливали из копии реплики